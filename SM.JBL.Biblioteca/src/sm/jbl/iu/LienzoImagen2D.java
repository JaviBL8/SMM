/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package sm.jbl.iu;

import java.awt.BasicStroke;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Rectangle;
import java.awt.Stroke;
import java.awt.image.BufferedImage;

/**
 *
 * @author JaviBl8
 */
public class LienzoImagen2D extends Lienzo2D {
    
    /**
     * BufferedImage activa en el lienzo
     */
    private BufferedImage img;
    /**
     * Boolean para activar el fondo o no
     */
    private boolean fondo=true;
    /**
     * Extensión del fichero
     */
    private String extension="PNG";
    /**
     * Altura del LienzoImagen2D
     */
    private int alto;
    /**
     * Ancho del LienzoImagen2D
     */
    private int ancho;
    
    /**
     * Establece una imagen para el lienzo
     * @param img Imagen que fijar en el lienzo
     */
    public void setImage(BufferedImage img){
        this.img = img;
        if(img!=null) {
            ancho=img.getWidth();
            alto=img.getHeight();
            setPreferredSize(new Dimension(ancho,alto));
            //Clip de la imagen
            setClip(new Rectangle(0, 0, ancho, alto));
        }       
    }
    
    /**
     * Establece si se desea fondo o no
     * @param fondo 1 para activar, 0 para desactivar
     */
    public void setFondo(boolean fondo){
        this.fondo=fondo;
    }
    
    /**
     * @return La imagen activa en el lienzo
     */
    public BufferedImage getImage(){
        return img;
    }
    
    @Override
    public void paintComponent(Graphics g){
        super.paintComponent(g);
        
        if(img!=null) g.drawImage(img,0,0,this);
        drawMarco(g);
        
    }
    
    /**
     * Creates new form LienzoImagen2D
     */
    public LienzoImagen2D() {
        initComponents();
        //setRecortar();
    }
    
    /**
     * @return El LienzoImagen2D actual
     */
    public LienzoImagen2D getLienzoImagen2D(){
        return this;
    }
    
    /**
     * Se comporta como getImage a no ser que drawVector sea true
     * @param drawVector Si es true devuelve la imagen convertida
     * @return BufferedImage del lienzo actual
     */
    public BufferedImage getImage(boolean drawVector){
        
        if (drawVector) {
            BufferedImage aux = new BufferedImage(img.getWidth(),img.getHeight(),img.getType());
            paint(aux.createGraphics());
            return aux;
        }
        else{
            return img;
        }
    }
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        addMouseMotionListener(new java.awt.event.MouseMotionAdapter() {
            public void mouseMoved(java.awt.event.MouseEvent evt) {
                formMouseMoved(evt);
            }
        });
        addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                formMouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                formMouseExited(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 400, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 300, Short.MAX_VALUE)
        );
    }// </editor-fold>//GEN-END:initComponents

    private void formMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseEntered
        //dentro = true;
    }//GEN-LAST:event_formMouseEntered

    private void formMouseMoved(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseMoved
       /*
        Point p = evt.getPoint();
        if(dentro){
            rgbValue = img.getRGB(p.x, p.y);
        }   */     
    }//GEN-LAST:event_formMouseMoved

    private void formMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_formMouseExited
        //dentro = false;
    }//GEN-LAST:event_formMouseExited
    
    /**
     * Traza el marco del lienzo de manera discontinua
     */
    private void drawMarco(Graphics g) {
    Graphics2D g2d = (Graphics2D)g;
    if(fondo){
        g2d.setColor(Color.WHITE);
        g2d.fillRect(0, 0, ancho, alto);   
    }
    Stroke sk = g2d.getStroke();
    float[] discontinuo = { 4.0F, 2.0F };
    Stroke marco = new BasicStroke(3.0F, 1, 1, 1.0F, discontinuo, 0.0F);
    g2d.setStroke(marco);
    g2d.draw(clip);
    //g2d.setStroke(sk);
    }

    /**
     * Cambia la extensión con la que se guardará el lienzo
     * @param ext String de la extension
     */
    public void setExtension(String ext){
       this.extension=ext;
    }
    
    /**
     * @return La extensión que se especificó para guardar el lienzo
     */
    public String getExtension(){
        return extension;
    }
    
    /**
     * Copiada de las transparencias de teoría
     * @param type Tipo de la imagen nueva
     * @return Imagen con tipo cambiado
     */
    public BufferedImage convertImageType(int type){
        if(img==null) return null;
        BufferedImage imOut = new BufferedImage(img.getWidth(),
        img.getHeight(), type);
        Graphics2D g2d = imOut.createGraphics();
        g2d.drawImage(img,0,0,null);
        img=imOut;
        return imOut;
    }    
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    // End of variables declaration//GEN-END:variables
}
